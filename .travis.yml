language: android
dist: trusty
node_js: 14
branches:
    only:
        - master
android:
    components:
        - tools
        # TODO: check if we need this
        - platform-tools-28.0.2
        - build-tools-28.0.3
        - sys-img-x86-android-28
stages:
    - name: test
      if: tag IS blank
jobs:
    fast_finish: true
    include:
        - name: "Run android"
          # manually install the android-28
          #      before_install:
          #        - touch $HOME/.android/repositories.cfg
          #        - yes | sdkmanager "platforms;android-28"
          #        - yes | sdkmanager "build-tools;28.0.3"
          #      before_cache:
          #        - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
          #        - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
          before_script:
              - echo no | android create avd --force -n TEST_DEVICE -t android-28 --abi x86 -c 100M
              # - echo no | avdmanager -s create avd -n TEST_DEVICE -k 'system-images;android-28;google_apis;x86' -c 100M
              - emulator -avd test -no-audio -no-window &
              - android-wait-for-emulator
              - adb shell input keyevent 82 &
          script:
              - adb -s TEST_DEVICE install apkname.apk